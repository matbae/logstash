# Author: Mattias Baecklund
filter {
  if "winlog" in [tags] {
    if [log_name_event_id] == "Microsoft-Windows-Sysmon_Microsoft-Windows-Sysmon/Operational_15" {
      # parse and create hash.md5 and hash.sha1 fields
      mutate {
        id => "copy file hashs"
        copy => { "[event_data][Hash]" => "hash_temp" }
      }
      mutate {
        id => "split file hashs"
        split => {"hash_temp" => ","}
        split => {"hash_temp[0]" => "=" }
        split => {"hash_temp[1]" => "=" }
      }
      mutate {
        id => "copy file hash"
        copy => {"hash_temp[0][1]" => "[hash][md5]"}
        copy => {"hash_temp[1][1]" => "[hash][sha1]"}
      }
      mutate {
        id => "cleanup"
        remove_field => ["hash_temp"]
      }
    }
  }
}