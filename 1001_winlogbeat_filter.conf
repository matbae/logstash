# Author: Mattias Baecklund
filter {
  if "winlog" in [tags] {
    mutate {
      id => "combine log event_id"
      add_field => { "log_name_event_id" => "%{log_name}_%{event_id}" }
    }
    
    if [log_name_event_id] == "Microsoft-Windows-Sysmon/Operational_3"{
      mutate {
        id => "create ips ports fields Microsoft-Windows-Sysmon/Operational_3"
        add_field => { "ips" => "%{[event_data][SourceIp]}"}
        add_field => { "ips" => "%{[event_data][DestinationIp]}"}
        add_field => { "ports" => "%{[event_data][SourcePort]}"}
        add_field => { "ports" => "%{[event_data][DestinationPort]}"}
      }
    }
  }   
}